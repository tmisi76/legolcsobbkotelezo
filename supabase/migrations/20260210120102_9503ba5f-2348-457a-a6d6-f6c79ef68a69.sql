
-- Create pages table
CREATE TABLE public.pages (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  slug text UNIQUE NOT NULL,
  title text NOT NULL,
  content text NOT NULL DEFAULT '',
  is_published boolean NOT NULL DEFAULT true,
  created_at timestamptz NOT NULL DEFAULT now(),
  updated_at timestamptz NOT NULL DEFAULT now()
);

ALTER TABLE public.pages ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view published pages" ON public.pages FOR SELECT USING (is_published = true);
CREATE POLICY "Admins can view all pages" ON public.pages FOR SELECT USING (has_role(auth.uid(), 'admin'));
CREATE POLICY "Admins can insert pages" ON public.pages FOR INSERT WITH CHECK (has_role(auth.uid(), 'admin'));
CREATE POLICY "Admins can update pages" ON public.pages FOR UPDATE USING (has_role(auth.uid(), 'admin'));
CREATE POLICY "Admins can delete pages" ON public.pages FOR DELETE USING (has_role(auth.uid(), 'admin'));

CREATE TRIGGER update_pages_updated_at BEFORE UPDATE ON public.pages FOR EACH ROW EXECUTE FUNCTION public.update_updated_at_column();

-- Create menu_items table
CREATE TABLE public.menu_items (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  label text NOT NULL,
  slug text NOT NULL,
  position text NOT NULL DEFAULT 'footer',
  sort_order integer NOT NULL DEFAULT 0,
  is_visible boolean NOT NULL DEFAULT true,
  created_at timestamptz NOT NULL DEFAULT now()
);

ALTER TABLE public.menu_items ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Anyone can view visible menu items" ON public.menu_items FOR SELECT USING (is_visible = true);
CREATE POLICY "Admins can view all menu items" ON public.menu_items FOR SELECT USING (has_role(auth.uid(), 'admin'));
CREATE POLICY "Admins can insert menu items" ON public.menu_items FOR INSERT WITH CHECK (has_role(auth.uid(), 'admin'));
CREATE POLICY "Admins can update menu items" ON public.menu_items FOR UPDATE USING (has_role(auth.uid(), 'admin'));
CREATE POLICY "Admins can delete menu items" ON public.menu_items FOR DELETE USING (has_role(auth.uid(), 'admin'));

-- Seed pages
INSERT INTO public.pages (slug, title, content, is_published) VALUES
('gyik', 'Gyakran Ismételt Kérdések', '[{"question":"Mennyibe kerül a szolgáltatás?","answer":"Teljesen ingyenes! Nem kérünk bankkártya adatokat és nincsenek rejtett díjak. A szolgáltatás fenntartását a biztosítókkal való együttműködés teszi lehetővé."},{"question":"Hogyan spórolhatok a kötelezőn?","answer":"Minden évben a biztosítási évforduló előtt 60 és 30 nap között van lehetőség biztosítót váltani. Ilyenkor az új biztosítók kedvező ajánlatokkal csábítják az ügyfeleket. Mi 50 nappal az évforduló előtt emlékeztetünk, hogy legyen időd összehasonlítani az ajánlatokat és kiválasztani a legjobbat."},{"question":"Biztonságban vannak az adataim?","answer":"Igen, GDPR kompatibilis adatkezelést alkalmazunk. Az adataidat titkosítva tároljuk és harmadik félnek csak a te kifejezett beleegyezéseddel adjuk át. Bármikor kérheted adataid törlését."},{"question":"Mi történik ha megadom a telefonszámom?","answer":"Személyesen felhívunk az évforduló előtti lehetséges váltási időszakban a legjobb, személyre szabott biztosítási ajánlatokkal. Nem spam hívásokról van szó - csak egyszer keresünk évente. A telefonszám megadása teljesen opcionális."},{"question":"Hány autót adhatok hozzá a fiókomhoz?","answer":"Nincs korlátozás! Korlátlan számú autót adhatsz hozzá, és mindegyikről külön emlékeztetőt kapsz a megfelelő időpontban."}]', true),
('aszf', 'Általános Szerződési Feltételek', '<p class="text-sm italic">Hatályos: 2026. január 1-től</p><section><h2>1. Szolgáltató adatai</h2><p><strong>Cégnév:</strong> H-Kontakt Group Kft.</p><p><strong>Székhely:</strong> 8900 Zalaegerszeg, Tompa Mihály u. 1-3. 1. emelet (a Göcsej Üzletházban)</p><p><strong>Telefon:</strong> 06-20-441-5868</p><p><strong>E-mail:</strong> info@h-kontakt.hu</p><p><strong>Tevékenység:</strong> Független biztosítási alkusz</p></section><section><h2>2. A szolgáltatás leírása</h2><p>A LegolcsóbbKötelező.hu egy ingyenes emlékeztető szolgáltatás, amely segít a felhasználóknak időben értesülni a kötelező gépjármű-felelősségbiztosítás évfordulójáról és a biztosításváltási lehetőségekről.</p><p>A szolgáltatás keretében:</p><ul><li>E-mail emlékeztetőket küldünk a biztosítás évfordulója előtt 30 és 60 nappal</li><li>Igény esetén segítünk a biztosításváltásban és új ajánlatok összehasonlításában</li><li>Személyes tanácsadást biztosítunk telefonon vagy e-mailben</li></ul></section><section><h2>3. Regisztráció</h2><p>A szolgáltatás használatához regisztráció szükséges. A regisztráció során megadott adatoknak valósnak és pontosnak kell lenniük. A felhasználó felelős a regisztrációs adatok naprakészen tartásáért.</p><p>A regisztrációval a felhasználó elfogadja a jelen ÁSZF-et és az Adatvédelmi Tájékoztatót.</p></section><section><h2>4. A szolgáltatás díja</h2><p>Az emlékeztető szolgáltatás <strong>teljes mértékben ingyenes</strong>. A regisztrációért, az emlékeztetők fogadásáért és a gépjárművek nyilvántartásáért nem számítunk fel díjat.</p><p>Amennyiben a felhasználó biztosítási szerződést köt az általunk közvetített ajánlat alapján, a jutalékot a biztosítótársaság fizeti – ez nem terheli a felhasználót többletköltséggel.</p></section><section><h2>5. Felelősség</h2><p>A szolgáltató <strong>nem biztosítótársaság</strong>, hanem független biztosítási alkuszként működik. A végső biztosítási döntés és szerződéskötés a felhasználó felelőssége.</p><p>A szolgáltató nem vállal felelősséget:</p><ul><li>A biztosítók díjainak és feltételeinek változásáért</li><li>A felhasználó által megadott pontatlan adatokból eredő következményekért</li><li>Az emlékeztetők kézbesítésének technikai akadályaiért (pl. spam szűrők)</li><li>A biztosítótársaságok döntéseiért és szolgáltatásaiért</li></ul></section><section><h2>6. Szellemi tulajdon</h2><p>A weboldal teljes tartalma, beleértve a szövegeket, grafikákat, logókat és egyéb anyagokat, szerzői jogi védelem alatt áll. Ezek másolása, terjesztése vagy felhasználása csak a szolgáltató előzetes írásbeli engedélyével lehetséges.</p></section><section><h2>7. Szerződés megszüntetése</h2><p>A felhasználó bármikor törölheti fiókját a beállítások menüpontban. A törlés esetén minden tárolt személyes adat véglegesen törlésre kerül 30 napon belül.</p><p>A szolgáltató fenntartja a jogot a felhasználói fiók felfüggesztésére vagy törlésére, amennyiben a felhasználó megsérti a jelen ÁSZF rendelkezéseit.</p></section><section><h2>8. Alkalmazandó jog</h2><p>A jelen ÁSZF-re és a szolgáltatás használatára a magyar jog az irányadó. Esetleges jogviták esetén a szolgáltató székhelye szerinti bíróság kizárólagos illetékességét kötjük ki.</p></section><section><h2>9. Módosítások</h2><p>A szolgáltató fenntartja a jogot a jelen ÁSZF egyoldalú módosítására. A módosításokról a felhasználókat e-mailben és a weboldalon értesítjük. A módosítások a közzétételtől számított 15 nap elteltével lépnek hatályba.</p><p>Amennyiben a felhasználó a módosítás hatálybalépése után folytatja a szolgáltatás használatát, azzal elfogadja a módosított feltételeket.</p></section><section><h2>10. Kapcsolat</h2><p>Az ÁSZF-fel kapcsolatos kérdésekkel keresd ügyfélszolgálatunkat:</p><p><strong>E-mail:</strong> info@h-kontakt.hu</p><p><strong>Telefon:</strong> 06-20-441-5868</p></section>', true),
('adatvedelem', 'Adatvédelmi Tájékoztató', '<p class="text-sm italic">Hatályos: 2026. január 1-től</p><section><h2>1. Adatkezelő</h2><p><strong>Cégnév:</strong> H-Kontakt Group Kft.</p><p><strong>Székhely:</strong> 8900 Zalaegerszeg, Tompa Mihály u. 1-3. 1. emelet (a Göcsej Üzletházban)</p><p><strong>Telefon:</strong> 06-20-441-5868</p><p><strong>E-mail:</strong> info@h-kontakt.hu</p></section><section><h2>2. Kezelt adatok köre</h2><p>A szolgáltatás igénybevétele során az alábbi személyes adatokat kezeljük:</p><ul><li>Teljes név</li><li>E-mail cím</li><li>Telefonszám (opcionális)</li><li>Gépjármű adatok (márka, típus, évjárat, rendszám)</li><li>Biztosítási évforduló dátuma</li><li>Jelenlegi biztosítási díj (opcionális)</li></ul></section><section><h2>3. Adatkezelés célja</h2><p>Az adatkezelés célja a kötelező gépjármű-felelősségbiztosítás évfordulója előtti emlékeztetők küldése, valamint igény esetén személyre szabott biztosítási ajánlatok készítése és közvetítése.</p></section><section><h2>4. Adatkezelés jogalapja</h2><p>Az adatkezelés az érintett önkéntes hozzájárulásán alapul a GDPR 6. cikk (1) bekezdés a) pontja szerint. A hozzájárulás a regisztráció során történik, és bármikor visszavonható.</p></section><section><h2>5. Adatok tárolása és biztonsága</h2><p>Az adatokat titkosított formában, az Európai Unió területén található szervereken tároljuk. Megfelelő technikai és szervezési intézkedésekkel biztosítjuk az adatok védelmét a jogosulatlan hozzáférés, módosítás vagy törlés ellen.</p><p>Az adatokat harmadik félnek kizárólag a Te kifejezett beleegyezéseddel, vagy jogszabályi kötelezettség esetén adjuk át.</p></section><section><h2>6. Adatmegőrzési idő</h2><p>A személyes adatokat a felhasználói fiók törléséig, vagy a hozzájárulás visszavonásáig kezeljük. A fiók törlése esetén az adatok véglegesen törlésre kerülnek 30 napon belül.</p></section><section><h2>7. Érintetti jogok</h2><p>A GDPR alapján az alábbi jogok illetnek meg:</p><ul><li><strong>Hozzáférés joga:</strong> Tájékoztatást kérhetsz a kezelt adataidról</li><li><strong>Helyesbítés joga:</strong> Kérheted pontatlan adataid javítását</li><li><strong>Törlés joga:</strong> Kérheted adataid törlését („elfeledtetéshez való jog")</li><li><strong>Korlátozás joga:</strong> Kérheted az adatkezelés korlátozását</li><li><strong>Adathordozhatóság joga:</strong> Kérheted adataid géppel olvasható formátumban való kiadását</li><li><strong>Tiltakozás joga:</strong> Tiltakozhatsz az adatkezelés ellen</li></ul><p>Jogaid gyakorlásához keresd ügyfélszolgálatunkat az info@h-kontakt.hu e-mail címen.</p></section><section><h2>8. Cookie-k (sütik) használata</h2><p>A weboldal működéséhez szükséges technikai cookie-kat használunk, valamint analitikai célú sütiket a felhasználói élmény javítása érdekében. A cookie-k használatáról a weboldal első látogatásakor tájékoztatást adunk.</p></section><section><h2>9. Jogorvoslati lehetőségek</h2><p>Amennyiben úgy érzed, hogy személyes adataid kezelése során jogaidat megsértettük, panasszal fordulhatsz a Nemzeti Adatvédelmi és Információszabadság Hatósághoz (NAIH):</p><p><strong>Cím:</strong> 1055 Budapest, Falk Miksa utca 9-11.</p><p><strong>Telefon:</strong> +36 1 391 1400</p><p><strong>E-mail:</strong> ugyfelszolgalat@naih.hu</p><p><strong>Weboldal:</strong> www.naih.hu</p></section><section><h2>10. Kapcsolat</h2><p>Adatvédelmi kérdésekkel kapcsolatban keresd ügyfélszolgálatunkat:</p><p><strong>E-mail:</strong> info@h-kontakt.hu</p><p><strong>Telefon:</strong> 06-20-441-5868</p></section>', true),
('kapcsolat', 'Kapcsolat', '<section><h2>Elérhetőségeink</h2><p><strong>Cégnév:</strong> H-Kontakt Group Kft.</p><p><strong>Székhely:</strong> 8900 Zalaegerszeg, Tompa Mihály u. 1-3. 1. emelet (a Göcsej Üzletházban)</p><p><strong>Telefon:</strong> 06-20-441-5868</p><p><strong>E-mail:</strong> info@h-kontakt.hu</p></section><section><h2>Nyitvatartás</h2><p>Hétfő - Péntek: 9:00 - 17:00</p><p>Szombat - Vasárnap: Zárva</p></section>', true),
('impresszum', 'Impresszum', '<section><h2>Kiadó</h2><p><strong>Cégnév:</strong> H-Kontakt Group Kft.</p><p><strong>Székhely:</strong> 8900 Zalaegerszeg, Tompa Mihály u. 1-3. 1. emelet (a Göcsej Üzletházban)</p><p><strong>Telefon:</strong> 06-20-441-5868</p><p><strong>E-mail:</strong> info@h-kontakt.hu</p><p><strong>Tevékenység:</strong> Független biztosítási alkusz</p></section><section><h2>Tárhelyszolgáltató</h2><p>A weboldal tárhelyét a Lovable (https://lovable.dev) biztosítja.</p></section>', true),
('munkatarsaink', 'Munkatársaink', '<section><h2>Csapatunk</h2><p>Hamarosan bemutatkoznak munkatársaink!</p></section>', false);

-- Seed menu items
INSERT INTO public.menu_items (label, slug, position, sort_order, is_visible) VALUES
('Adatvédelem', 'adatvedelem', 'footer', 1, true),
('ÁSZF', 'aszf', 'footer', 2, true),
('Kapcsolat', 'kapcsolat', 'footer', 3, true),
('Impresszum', 'impresszum', 'footer', 4, true);
